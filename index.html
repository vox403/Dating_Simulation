<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Vox Dating Simulation Â· V-Sync System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body {
      width: 100%;
      height: 100%;
      background: #02040a;
      color: #e8f7ff;
      font-family: "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      overflow: hidden;
    }

    body.vsync-cursor {
      cursor: default;
    }

    .hidden { display:none !important; }

    .screen {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #152032 0, #02040a 55%, #000 100%);
      overflow: hidden;
    }

    .screen.hidden {
      display: none;
    }

    /* ===== V-SYNC ACCESS PROTOCOL ë¡œë”© í™”ë©´ ===== */
    #loading-screen {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: radial-gradient(circle at top, #050f1f 0, #02040a 55%, #000 100%);
      z-index: 50;
      font-family: Consolas, monospace;
      transition: opacity 0.4s ease;
    }

    .loading-box {
      width: min(520px, 90vw);
      padding: 26px 30px 22px;
      border-radius: 10px;
      border: 1px solid #26d1ff;
      background: radial-gradient(circle at top, rgba(6, 20, 34, 0.96), rgba(3, 9, 18, 0.98));
      box-shadow:
        0 0 25px rgba(38, 209, 255, 0.45),
        0 0 80px rgba(12, 140, 255, 0.35);
    }

    .loading-title {
      font-size: 0.9rem;
      letter-spacing: 0.25em;
      text-transform: uppercase;
      color: #36e1ff;
      margin-bottom: 16px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(54, 225, 255, 0.28);
    }

    .loading-line {
      font-family: "Consolas", "SFMono-Regular", ui-monospace, Menlo, Monaco, monospace;
      font-size: 0.88rem;
      line-height: 1.3;
      margin: 5px 0;
      opacity: 0;
      transform: translateY(4px);
      transition: opacity 0.5s ease, transform 0.5s ease;
    }

    .loading-line span.en {
      display: block;
    }

    .loading-line span.ko {
      display: block;
      font-size: 0.78rem;
      opacity: 0.7;
      margin-top: 1px;
    }

    .loading-line.active {
      opacity: 1;
      color: #f3fbff;
      transform: translateY(0);
    }

    .loading-progress {
      margin-top: 18px;
      width: 100%;
      height: 3px;
      border-radius: 999px;
      background: rgba(8, 20, 32, 0.95);
      overflow: hidden;
      border: 1px solid rgba(18, 40, 60, 0.9);
    }

    .loading-progress-bar {
      height: 100%;
      width: 30%;
      background: linear-gradient(90deg, #18c6ff, #7c5bff, #ff4af8);
      box-shadow: 0 0 10px rgba(68, 205, 255, 0.9);
      animation: loading-scan 1.2s linear infinite;
    }

    @keyframes loading-scan {
      0%   { transform: translateX(-120%); }
      100% { transform: translateX(260%); }
    }

    /* MAIN MENU */
    #main-menu {
      flex-direction: column;
      padding: 24px;
      text-align: center;
    }

    .title-logo {
      font-size: clamp(1.4rem, 2.2vw, 2rem);
      letter-spacing: 0.35em;
      text-transform: uppercase;
      color: #32e3ff;
      margin-bottom: 4px;
    }

    .title-sub {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-bottom: 32px;
    }

    .menu-buttons {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: min(320px, 80vw);
      margin: 0 auto 18px;
    }

    .btn {
      border: 1px solid rgba(225, 240, 255, 0.4);
      padding: 10px 14px;
      font-size: 0.9rem;
      letter-spacing: 0.15em;
      text-transform: uppercase;
      background: rgba(8, 20, 32, 0.9);
      color: #e8f7ff;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease, border-color 0.15s ease;
    }

    .btn:hover {
      background: rgba(20, 54, 90, 0.95);
      transform: translateY(-1px);
      box-shadow: 0 0 14px rgba(50, 227, 255, 0.35);
      border-color: #32e3ff;
    }

    .btn-secondary {
      border-color: rgba(150, 180, 200, 0.5);
      background: rgba(4, 10, 18, 0.95);
      font-size: 0.8rem;
    }

    /* GLOBAL TOP BAR (ì–¸ì–´/ì‚¬ìš´ë“œ í‘œì‹œìš© ì‘ì€ ë°”) */
    .top-bar {
      position: absolute;
      top: 10px;
      right: 12px;
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.8rem;
      opacity: 0.85;
      z-index: 5;
    }

    .top-pill {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid rgba(176, 214, 255, 0.6);
      background: rgba(6, 14, 26, 0.92);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .top-pill span.label {
      opacity: 0.75;
    }

    .top-pill button {
      border: none;
      background: transparent;
      color: #e8f7ff;
      cursor: pointer;
      padding: 0;
      font-size: 0.8rem;
    }

    /* GAME SCREEN */
    #game-screen {
      flex-direction: column;
      align-items: stretch;
      justify-content: stretch;
    }

    .game-background {
      position: absolute;
      inset: 0;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      filter: brightness(0.88);
      z-index: 0;
    }

    .game-backdrop {
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.7) 0, rgba(0,0,0,0.35) 50%, rgba(0,0,0,0.1) 100%);
      z-index: 1;
    }

    .game-ui {
      position: relative;
      z-index: 2;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 18px 16px;
      justify-content: flex-end;
      gap: 12px;
    }

    .chapter-label {
      align-self: flex-start;
      margin-left: 4px;
      margin-bottom: auto;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 0.7rem;
      letter-spacing: 0.14em;
      text-transform: uppercase;
      border: 1px solid rgba(50, 227, 255, 0.7);
      background: rgba(2, 10, 18, 0.85);
      color: #9fe5ff;
    }

    .dialogue-box {
      width: min(880px, 100%);
      margin: 0 auto;
      background: linear-gradient(to top, rgba(5, 12, 18, 0.96), rgba(7, 24, 36, 0.96));
      border-radius: 12px;
      border: 1px solid rgba(101, 216, 255, 0.7);
      box-shadow: 0 0 20px rgba(28, 150, 210, 0.5);
      padding: 12px 16px 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      position: relative;
    }

    .speaker-name {
      font-size: 0.8rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #32e3ff;
      opacity: 0.9;
    }

    .dialogue-text {
      min-height: 64px;
      font-size: 0.9rem;
      line-height: 1.5;
      color: #ffffff;
      white-space: pre-line;
    }

    .dialogue-next {
      position: absolute;
      right: 12px;
      bottom: 6px;
      font-size: 0.8rem;
      opacity: 0.7;
    }

    .dialogue-next.hidden {
      opacity: 0;
    }

    .choices {
      margin-top: 10px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .choice-btn {
      border-radius: 8px;
      border: 1px solid rgba(80, 160, 210, 0.8);
      background: rgba(6, 20, 32, 0.95);
      padding: 7px 10px;
      font-size: 0.85rem;
      text-align: left;
      cursor: pointer;
      transition: background 0.15s ease, transform 0.08s ease, box-shadow 0.15s ease;
      color: #ffffff;
    }

    .choice-btn:hover {
      background: rgba(20, 54, 90, 0.98);
      transform: translateY(-1px);
      box-shadow: 0 0 12px rgba(50, 227, 255, 0.4);
      color: #ffffff;
    }

    .name-input-wrapper {
      margin-top: 6px;
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .name-input-wrapper input {
      flex: 1;
      background: rgba(3, 12, 22, 0.94);
      border-radius: 6px;
      border: 1px solid rgba(110, 180, 220, 0.9);
      padding: 6px 8px;
      color: #eaf7ff;
      font-size: 0.85rem;
    }

    .name-input-wrapper button {
      border-radius: 6px;
      border: 1px solid rgba(110, 180, 220, 0.9);
      background: rgba(10, 34, 52, 0.96);
      color: #eaf7ff;
      padding: 6px 10px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    /* SIMPLE PANELS (ENDING DB / CREDITS / SETTINGS) */
    .panel {
      width: min(900px, 96vw);
      max-height: 90vh;
      border-radius: 14px;
      border: 1px solid rgba(60, 190, 255, 0.8);
      background: radial-gradient(circle at top, rgba(12, 34, 54, 0.98), rgba(3, 10, 20, 0.98));
      box-shadow: 0 0 30px rgba(30, 150, 220, 0.65);
      padding: 16px 18px 14px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      overflow: hidden;
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(148, 212, 255, 0.4);
      padding-bottom: 8px;
      margin-bottom: 6px;
    }

    .panel-title {
      font-size: 0.9rem;
      letter-spacing: 0.24em;
      text-transform: uppercase;
      color: #9fe5ff;
    }

    .panel-close {
      cursor: pointer;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    .panel-body {
      overflow-y: auto;
      padding-right: 6px;
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .credits-section-title {
      margin-top: 4px;
      margin-bottom: 4px;
      letter-spacing: 0.18em;
      text-transform: uppercase;
      font-size: 0.8rem;
      color: #32e3ff;
    }

    .credits-list {
      margin-bottom: 8px;
    }

    .credits-list div {
      margin: 2px 0;
    }

    .settings-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(120, 170, 210, 0.35);
    }

    .settings-label {
      font-size: 0.85rem;
      opacity: 0.9;
    }

    .settings-controls {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .pill-toggle {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid rgba(130, 180, 220, 0.7);
      background: rgba(5, 15, 25, 0.96);
      font-size: 0.8rem;
      cursor: pointer;
      opacity: 0.8;
      color: #ffffff !important;
    }

    .pill-toggle.active {
      border-color: #32e3ff;
      background: rgba(12, 36, 54, 0.98);
      opacity: 1;
      box-shadow: 0 0 12px rgba(50, 227, 255, 0.6);
    }

    /* ENDING DATABASE */
    .ending-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
      gap: 10px;
      margin-top: 6px;
    }

    .ending-card {
      border-radius: 10px;
      border: 1px solid rgba(130, 190, 240, 0.8);
      background: rgba(3, 12, 22, 0.96);
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .ending-thumb {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 6px;
      background-position: center;
      background-size: cover;
      background-repeat: no-repeat;
      margin-bottom: 4px;
      position: relative;
      overflow: hidden;
    }

    .ending-thumb.locked {
      filter: grayscale(1) blur(1px);
    }

    .ending-code {
      font-size: 0.75rem;
      opacity: 0.8;
    }

    .ending-title {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .ending-desc {
      font-size: 0.78rem;
      opacity: 0.85;
    }

    .ending-locked-label {
      font-size: 0.8rem;
      opacity: 0.6;
    }

    .ending-tag {
      position: absolute;
      left: 6px;
      top: 6px;
      font-size: 0.7rem;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(3, 8, 16, 0.85);
      border: 1px solid rgba(200, 230, 255, 0.8);
    }

    .small-note {
      font-size: 0.75rem;
      opacity: 0.8;
      margin-top: 6px;
    }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 6px;
    }
    ::-webkit-scrollbar-track {
      background: rgba(5, 12, 24, 0.9);
    }
    ::-webkit-scrollbar-thumb {
      background: rgba(90, 160, 210, 0.9);
      border-radius: 999px;
    }

    /* === í…ìŠ¤íŠ¸ ìƒ‰ ê°•ì œ í°ìƒ‰ === */
    .dialogue-text,
    .choice-btn,
    .pill-toggle {
      color: #ffffff !important;
    }

    .game-video-bg {
      position: absolute;
      inset: 0;
      object-fit: cover;
      z-index: 0;
      background: #000;
    }

    /* ì´ë¯¸ì§€/ì˜ìƒ ì¤‘ì•™ ë°°ì¹˜ ê°•ì œ */
    .game-background,
    .game-video-bg {
      position: absolute;
      width: 100%;
      height: 100%;
      left: 0;
      top: 0;
    }

    .game-background {
      background-position: center center !important;
      background-size: cover !important;
    }

    .game-video-bg {
      object-fit: cover !important;
      object-position: center center !important;
    }

    /* ì˜¤ë²„ë ˆì´ ê³µí†µ */
    .game-overlay {
      position: absolute;
      inset: 0;
      z-index: 3;
      display: flex;
      align-items: center;
      justify-content: center;
      pointer-events: none; /* í´ë¦­ì€ ì•„ë˜(ê²Œì„ UI)ë¡œ */
    }

    /* ê³„ì•½ì„œ íŒ¨ë„ */
    .contract-panel {
      pointer-events: auto;
      width: min(780px, 95vw);
      max-height: 70vh;
      padding: 18px 20px 16px;
      border-radius: 12px;
      border: 1px solid rgba(60, 220, 255, 0.9);
      background: radial-gradient(circle at top,
                  rgba(8, 26, 46, 0.98),
                  rgba(3, 10, 20, 0.98));
      box-shadow:
        0 0 24px rgba(60, 220, 255, 0.5),
        0 0 80px rgba(10, 140, 255, 0.45);
      color: #eaf7ff;
      font-size: 0.82rem;
      line-height: 1.5;
      overflow-y: auto;
    }

    .contract-header {
      font-size: 0.82rem;
      letter-spacing: 0.26em;
      text-transform: uppercase;
      color: #9fe5ff;
      margin-bottom: 8px;
      padding-bottom: 6px;
      border-bottom: 1px solid rgba(160, 220, 255, 0.5);
    }

    .contract-body {
      font-size: 0.8rem;
    }

    .contract-body p {
      margin: 4px 0 6px;
    }

    .contract-body strong {
      color: #32e3ff;
    }

    .contract-fade {
      opacity: 0.7;
      font-size: 0.75rem;
    }

    /* ko / en ì „í™˜ìš© */
    .contract-en.hidden,
    .contract-ko.hidden {
      display: none;
    }
  </style>
</head>
<body class="vsync-cursor">
  <!-- LOADING SCREEN -->
  <div id="loading-screen">
    <div class="loading-box">
      <div class="loading-title">V-Sync ACCESS PROTOCOL</div>
      <div class="loading-line" data-step="0">
        <span class="en">Scanning User Credentialsâ€¦</span>
        <span class="ko">ì‚¬ìš©ì ì¸ì¦ ì •ë³´ë¥¼ ìŠ¤ìº”í•˜ëŠ” ì¤‘â€¦</span>
      </div>
      <div class="loading-line" data-step="1">
        <span class="en">Verifying Access Levelâ€¦</span>
        <span class="ko">ì ‘ê·¼ ê¶Œí•œì„ ê²€ì¦í•˜ëŠ” ì¤‘â€¦</span>
      </div>
      <div class="loading-line" data-step="2">
        <span class="en">All Checks Passed.</span>
        <span class="ko">ëª¨ë“  ì²´í¬ í†µê³¼.</span>
      </div>
      <div class="loading-line" data-step="3">
        <span class="en">â€¦Clear. Access Granted.</span>
        <span class="ko">â€¦í´ë¦¬ì–´. ì ‘ê·¼ ìŠ¹ì¸.</span>
      </div>
      <div class="loading-progress">
        <div class="loading-progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- MAIN MENU -->
  <div id="main-menu" class="screen hidden">
    <div class="top-bar">
      <div class="top-pill">
        <span class="label">LANG</span>
        <span id="top-lang-label">KO</span>
      </div>
      <div class="top-pill">
        <span class="label">SOUND</span>
        <button id="top-sound-toggle">ON</button>
      </div>
    </div>
    <div>
      <div class="title-logo">VOX DATING SIMULATION</div>
      <div class="title-sub">V-Sync System Â· Protocol Interface</div>
      <div class="menu-buttons">
        <button class="btn" id="btn-start">START</button>
        <button class="btn" id="btn-ending-db">ENDING DATABASE</button>
        <button class="btn" id="btn-credits">CREDITS</button>
        <button class="btn" id="btn-settings">SYSTEM SETTINGS</button>
      </div>
      <div style="font-size:0.75rem; opacity:0.65;">
        â€» ì–¸ì–´ ë° ìë™ ì‚¬ìš´ë“œ ì„¤ì •ì€ SYSTEM SETTINGSì—ì„œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
      </div>
    </div>
  </div>

  <!-- GAME SCREEN -->
  <div id="game-screen" class="screen hidden">
    <div class="top-bar">
      <div class="top-pill">
        <span class="label">LANG</span>
        <span id="game-lang-label">KO</span>
      </div>
      <div class="top-pill">
        <span class="label">BGM</span>
        <button id="game-sound-toggle">ON</button>
      </div>
    </div>

    <!-- ë°°ê²½ -->
    <div id="game-bg" class="game-background"></div>
    <video id="game-video-bg" class="game-video-bg hidden" muted loop playsinline></video>
    <div class="game-backdrop"></div>

    <!-- ê³„ì•½ì„œ í™€ë¡œê·¸ë¨ íŒ¨ë„ ì˜¤ë²„ë ˆì´ -->
    <div id="contract-overlay" class="game-overlay hidden">
      <div class="contract-panel">
        <div class="contract-header">VOXTEK EMPLOYMENT & DATA UTILIZATION AGREEMENT</div>

        <!-- Korean -->
        <div class="contract-body contract-ko">
          <p>ë³¸ ê³„ì•½ì„œëŠ” VoxTek(ì´í•˜ â€˜íšŒì‚¬â€™)ì™€ ê·€í•˜(ì´í•˜ â€˜ê³„ì•½ìâ€™) ê°„ì˜ ì—…ë¬´ ìˆ˜í–‰ ë° ë°ì´í„° ì²˜ë¦¬ì— ê´€í•œ ê¶Œë¦¬Â·ì˜ë¬´ë¥¼ ê·œì •í•œë‹¤.</p>
          <p>ë™ì˜ ë²„íŠ¼ì„ ëˆ„ë¥´ëŠ” ì¦‰ì‹œ, ê³„ì•½ìëŠ” ì•„ë˜ ëª¨ë“  ì¡°í•­ì— ë™ì˜í•œ ê²ƒìœ¼ë¡œ ê°„ì£¼ëœë‹¤.</p>
          <hr>
          <p><strong>ì œ 1 ì¡° â€” ê³„ì•½ ëª©ì </strong><br>
          ë³¸ ê³„ì•½ì˜ ëª©ì ì€ ê³„ì•½ìê°€ VoxTekì˜ ë°©ì†¡Â·ë³´ì•ˆ ì—…ë¬´ì— ì°¸ì—¬í•˜ê³ , íšŒì‚¬ì˜ ì „ë°˜ì ì¸ ì‚¬ì—… ìš´ì˜ì— ê¸°ì—¬í•˜ëŠ” ê²ƒì´ë‹¤.</p>
          <p><strong>ì œ 2 ì¡° â€” ê·¼ë¬´ ë²”ìœ„</strong><br>
          â–ª ë°©ì†¡ ê°„ì„­, íŒ¨í‚· ì¡°ì •, ì‹ í˜¸ ë™ê¸°í™” ì—…ë¬´ ì§€ì›<br>
          â–ª ì§€ì˜¥ ì „ì—­ì˜ ë°ì´í„° ëª¨ë‹ˆí„°ë§ ë° ì´ìƒ ì‹ í˜¸ ë³´ê³ <br>
          â–ª VoxTek ë¸Œëœë“œ ì´ë¯¸ì§€ ìœ ì§€ ë° ê²½ìŸì‚¬ ëŒ€ì‘<br>
          â–ª í•„ìš” ì‹œ CEO ë³µìŠ¤ì˜ ì§ì ‘ ì§€ì‹œ ìˆ˜í–‰ (ê±°ë¶€ ì‹œ í•´ë‹¹ ë¡œê·¸ê°€ ìë™ ê¸°ë¡ë¨)</p>
          <p class="contract-fade">â€¦ (ì „ì²´ ì•½ê´€ì€ ê²Œì„ ë‚´ì—ì„œ ì¶•ì•½ í‘œì‹œ)</p>
        </div>

        <!-- English -->
        <div class="contract-body contract-en hidden">
          <p>This agreement defines the rights and obligations related to task execution and data handling between VoxTek (â€œthe Companyâ€) and you (â€œthe Contractorâ€).</p>
          <p>By selecting Agree, the Contractor is deemed to have accepted all terms below.</p>
          <hr>
          <p><strong>Article 1 â€” Purpose</strong><br>
          The purpose of this agreement is for the Contractor to participate in VoxTekâ€™s broadcasting and security operations and to contribute to the Companyâ€™s overall business activities.</p>
          <p><strong>Article 2 â€” Scope of Work</strong><br>
          â–ª Interference assistance in broadcasting signals, packet adjustment, and synchronization support<br>
          â–ª Monitoring data across all of Hell and reporting any abnormal signals<br>
          â–ª Upholding the VoxTek brand image and responding to competitor activity<br>
          â–ª Executing direct orders from CEO Vox when required (Refusal will be automatically logged)</p>
          <p class="contract-fade">â€¦ (Full terms are summarized for in-game display)</p>
        </div>
      </div>
    </div>

    <!-- GAME UI -->
    <div class="game-ui" id="game-click-area">
      <div class="chapter-label" id="chapter-label"></div>
      <div class="dialogue-box">
        <div class="speaker-name" id="speaker-name"></div>
        <div class="dialogue-text" id="dialogue-text"></div>
        <div class="choices" id="choices"></div>
        <div class="name-input-wrapper hidden" id="name-input-wrapper">
          <input type="text" id="player-name-input" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš” / Enter your name" />
          <button id="player-name-confirm">OK</button>
        </div>
        <div class="dialogue-next hidden" id="dialogue-next">NEXT â–·</div>
      </div>
    </div>
  </div>

  <!-- ENDING DATABASE -->
  <div id="ending-db-screen" class="screen hidden">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">ENDING DATABASE</div>
        <div class="panel-close" data-close="ending-db-screen">âœ•</div>
      </div>
      <div class="panel-body">
        <div id="ending-db-grid" class="ending-grid"></div>
        <div class="small-note">
          â€» ì—”ë”©ì„ ë‹¬ì„±í•˜ë©´ ì—¬ê¸°ì—ì„œ ì´ë¯¸ì§€ì™€ ì œëª©ì´ í•´ê¸ˆë©ë‹ˆë‹¤. (ë¸Œë¼ìš°ì € localStorage ì €ì¥)
        </div>
      </div>
    </div>
  </div>

  <!-- CREDITS -->
  <div id="credits-screen" class="screen hidden">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">CREDITS</div>
        <div class="panel-close" data-close="credits-screen">âœ•</div>
      </div>
      <div class="panel-body">
        <div class="credits-section-title">â”€â”€â”€â”€â”€â”€ CREATOR UNIT â”€â”€â”€â”€â”€â”€</div>
        <div class="credits-list">
          <div>ğŸ•¶ Director Â· V-Sync</div>
          <div>ğŸ¨ Illustrator Â· @EYE215 &amp; V-Sync</div>
          <div>ğŸ›ï¸ Sound / Music Â· V-Sync</div>
        </div>

        <div class="credits-section-title">â”€â”€â”€â”€â”€ SYSTEM TEST UNIT â”€â”€â”€â”€â”€</div>
        <div class="credits-list">
          <div>ğŸ“¡ Velvette</div>
          <div>ğŸ“¡ Dockggang</div>
          <div>ğŸ“¡ ì• ì•„ë¹ </div>
          <div>ğŸ“¡ Princess of Hell</div>
          <div>ğŸ“¡ BlitzÃ¸</div>
        </div>
      </div>
    </div>
  </div>

  <!-- SYSTEM SETTINGS -->
  <div id="settings-screen" class="screen hidden">
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">SYSTEM SETTINGS</div>
        <div class="panel-close" data-close="settings-screen">âœ•</div>
      </div>
      <div class="panel-body">
        <div class="settings-row">
          <div class="settings-label">ì–¸ì–´ / Language</div>
          <div class="settings-controls">
            <button class="pill-toggle" data-lang="ko">Korean</button>
            <button class="pill-toggle" data-lang="en">English</button>
          </div>
        </div>
        <div class="settings-row">
          <div class="settings-label">ìë™ ì‚¬ìš´ë“œ / Auto Sound</div>
          <div class="settings-controls">
            <button class="pill-toggle" data-autosound="on">ON</button>
            <button class="pill-toggle" data-autosound="off">OFF</button>
          </div>
        </div>
        <div class="small-note">
          â€» START ì´í›„ ê²Œì„ í™”ë©´ë¶€í„° ì„¤ì •ì´ ì ìš©ë©ë‹ˆë‹¤. ì—”ë”© ì •ë³´ëŠ” ë¸Œë¼ìš°ì € localStorageì— ì €ì¥ë©ë‹ˆë‹¤.
        </div>
      </div>
    </div>
  </div>

<script>
  /* =============================
     ê¸°ë³¸ ìƒíƒœ & ë¡œì»¬ ìŠ¤í† ë¦¬ì§€
     ============================= */
  const SETTINGS_KEY = "vds_settings";
  const ENDINGS_KEY  = "vds_endings";

  function loadSettings() {
    try {
      const raw = localStorage.getItem(SETTINGS_KEY);
      if (!raw) return { lang: "ko", autoSound: true };
      const parsed = JSON.parse(raw);
      return {
        lang: parsed.lang === "en" ? "en" : "ko",
        autoSound: parsed.autoSound !== false
      };
    } catch (e) {
      return { lang: "ko", autoSound: true };
    }
  }

  function saveSettings() {
    localStorage.setItem(SETTINGS_KEY, JSON.stringify(settings));
  }

  function loadEndings() {
    try {
      const raw = localStorage.getItem(ENDINGS_KEY);
      if (!raw) return {};
      return JSON.parse(raw);
    } catch (e) {
      return {};
    }
  }

  function saveEndings() {
    localStorage.setItem(ENDINGS_KEY, JSON.stringify(unlockedEndings));
  }

  const settings = loadSettings();
  const unlockedEndings = loadEndings();

  /* =============================
     ì˜¤ë””ì˜¤ (ì¥ë©´ë³„ BGM)
     ============================= */
  const audioFiles = {
    main: "Falling.mp3",    // ë©”ì¸ í™”ë©´
    scene0: "Falling.mp3",
    scene1: "Falling.mp3",
    scene2: "Falling.mp3",
    scene3: "Falling.mp3",
    scene4: "Falling.mp3",
    scene5: "Falling.mp3"
  };

  const audioMap = {};
  let currentBgmKey = null;
  let globalMuted = false; // ìƒë‹¨ BGM ON/OFF ë²„íŠ¼ ìš©

  function initAudio() {
    for (const key in audioFiles) {
      const a = new Audio(audioFiles[key]);
      a.loop = true;
      audioMap[key] = a;
    }
  }

  function stopAllBgm() {
    Object.values(audioMap).forEach(a => {
      a.pause();
    });
  }

  function playBgm(key) {
    currentBgmKey = key;
    stopAllBgm();
    const a = audioMap[key];
    if (!a) return;
    a.muted = globalMuted;
    if (settings.autoSound && !globalMuted) {
      a.currentTime = 0;
      a.play().catch(() => {});
    }
  }

  /* =============================
     ì—”ë”© ë©”íƒ€ë°ì´í„° (ENDING DATABASE)
     ============================= */
  const ENDINGS = [
    {
      id: "end0",
      code: "END 0",
      img: "(1)Calibration_Suite_door.png",
      title: {
        ko: "ìŠ¹ì¸ê±°ì ˆ",
        en: "Rejection"
      },
      desc: {
        ko: "ìŠ¹ì¸ê±°ì ˆ :: ì‘ë‹µ ë¶ˆí•„ìš”. ë‹¤ìŒ ì ˆì°¨ë¡œ ì´ë™í•©ë‹ˆë‹¤.",
        en: "Rejection :: No response required. Proceeding to the next protocol."
      }
    },
    {
      id: "end1",
      code: "END 1",
      img: "mmm111.jpg",
      title: {
        ko: "ì •ë³µ íŒŒíŠ¸ë„ˆ",
        en: "Conquest Partner"
      },
      desc: {
        ko: "ì§€ì˜¥Â·ì²œêµ­ ë¦¬ë¶€íŠ¸, ë¹„ì¦ˆë‹ˆìŠ¤ëŠ” ì–¸ì œë‚˜ íš¨ìœ¨ì ì´ì–´ì•¼ í•©ë‹ˆë‹¤.",
        en: "Hell and Heaven rebooted. Business must always stay efficient."
      }
    },
    {
      id: "end2",
      code: "END 2",
      img: "mmm111.jpg",
      title: {
        ko: "ì—­ì „ ì§€ë°°",
        en: "Overthrow"
      },
      desc: {
        ko: "ë³µìŠ¤. ì´ì œ ì•Œê² ì§€? ì´ íŒë„, ë„ˆë„â€”ëª¨ë‘ ë‚´ ì†ë°”ë‹¥ ìœ„ì•¼.",
        en: "Vox. Now you see it, donâ€™t you? This whole gameâ€”including youâ€”has been in the palm of my hand."
      }
    },
    {
      id: "end3",
      code: "END 3",
      img: "mmm111.jpg",
      title: {
        ko: "ë°°ì‹ ì",
        en: "The Betrayer"
      },
      desc: {
        ko: "ì €ëŠ” í‰í™”ë¥¼ ìœ„í•´ í–‰ë™í–ˆì„ ë¿ì…ë‹ˆë‹¤.",
        en: "Everything I didâ€¦ was for peace."
      }
    },
    {
      id: "end4",
      code: "END 4",
      img: "mmm111.jpg",
      title: {
        ko: "ì¢€ë¹„ ì¸í„´",
        en: "Zombie Intern"
      },
      desc: {
        ko: "ì™œ ì¼ì´ ì•ˆ ëë‚˜ì£ ? ì•¼ê·¼ì€ ì‹«ìŠµë‹ˆë‹¤.",
        en: "Why isnâ€™t the work finished yet? I really donâ€™t want overtimeâ€¦"
      }
    }
  ];

  function unlockEnding(id) {
    unlockedEndings[id] = true;
    saveEndings();
  }

  /* =============================
     ìŠ¤í¬ë¦½íŠ¸ ë°ì´í„°
     ============================= */
  const SCRIPT = {
    ko: {
      scenes: {
        /* ========== SCENE 0 ========== */
        scene0_intro: {
          chapter:
            "[ì¥ë©´0] V-íƒ€ì›Œ Â· ë¸Œì´-ì‹±í¬ ì¡°ìœ¨ì‹¤ ë¬¸ ì•\nChapter 0. í”„ë¡¤ë¡œê·¸ â€” V-Syncì™€ì˜ ëŒ€ë©´",
          bg: "(1)Calibration_Suite_door.png",
          steps: [
            {
              type: "line",
              speaker: "",
              bg: "(1)Calibration_Suite_door.png",
              text:
                "ë‹¹ì‹ ì´ ë¬¸ ì•ì— ë‹¤ê°€ì„œëŠ” ìˆœê°„, ì •ì ì„ ê°€ë¥´ë“¯ ì¹˜ì§â”€í•˜ëŠ” ì‘ì€ ì „ë¥˜ìŒì´ íŠ€ì—ˆë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "(1)Calibration_Suite_door.png",
              text:
                "ê³§ ê¸ˆì† íŒ¨ë„ì˜ ì¤‘ì•™ì„ ë”°ë¼ ì–‡ì€ ë„¤ì˜¨ ë¼ì¸ì´ ì ë“±ë˜ê³ , ê·¸ ìœ„ë¡œ í™€ë¡œê·¸ë¨ íŒ¨ë„ê³¼ ë„¤ëª¨ë‚œ í‚¤ë³´ë“œê°€ ê³µì¤‘ì— í¼ì³ì§„ë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "í™€ë¡œê·¸ë¨",
              bg: "Sc_01.mp4",
              text: "[í™€ë¡œê·¸ë¨ : ë°©ë¬¸ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš”.]",
              autoNext: false
            },
            {
              type: "choice",
              choiceId: 1,
              storeChoiceKey: "c1",
              options: [
                {
                  text: "Vox Dating Simulation Projectì— ê´€ì‹¬ì´ ìˆìŠµë‹ˆë‹¤.",
                  nextScene: "scene0_after_choice1"
                },
                {
                  text: "ê·¸ëƒ¥ ë³´ê³  ì‹¶ì–´ì„œìš”.",
                  nextScene: "scene0_reject"
                }
              ]
            }
          ]
        },

        scene0_reject: {
          chapter:
            "[ì¥ë©´0] V-íƒ€ì›Œ Â· ë¸Œì´-ì‹±í¬ ì¡°ìœ¨ì‹¤ ë¬¸ ì•\nChapter 0. í”„ë¡¤ë¡œê·¸ â€” V-Syncì™€ì˜ ëŒ€ë©´",
          bg: "(1)Calibration_Suite_door.png",
          steps: [
            {
              type: "line",
              speaker: "",
              bg: "Sc_03.mp4",
              text: "ë¬¸ì€ ê·¸ëŒ€ë¡œ ì ê¸´ ì±„ ë¯¸ë™ë„ ì—†ë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "Sc_03.mp4",
              text: "í™€ë¡œê·¸ë¨ì€ ì„œì„œíˆ ì‚¬ë¼ì§€ê³  ì¸í„°í˜ì´ìŠ¤ê°€ ë‹«íŒë‹¤.",
              autoNext: true
            },
            {
              type: "ending",
              speaker: "",
              bg: "(1)Calibration_Suite_door.png",
              endingId: "end0",
              text:
                "â–  END 0. ìŠ¹ì¸ê±°ì ˆ\nìŠ¹ì¸ê±°ì ˆ :: ì‘ë‹µ ë¶ˆí•„ìš”. ë‹¤ìŒ ì ˆì°¨ë¡œ ì´ë™í•©ë‹ˆë‹¤.",
              autoNext: false
            }
          ]
        },

        scene0_after_choice1: {
          chapter:
            "[ì¥ë©´0] V-íƒ€ì›Œ Â· ë¸Œì´-ì‹±í¬ ì¡°ìœ¨ì‹¤ ë¬¸ ì•\nChapter 0. í”„ë¡¤ë¡œê·¸ â€” V-Syncì™€ì˜ ëŒ€ë©´",
          bg: "(1)Calibration_Suite_door.png",
          steps: [
            {
              type: "line",
              speaker: "í™€ë¡œê·¸ë¨",
              bg: "Sc_02.mp4",
              text: "[í™€ë¡œê·¸ë¨ : í™•ì¸ ì¤‘...]",
              autoNext: true
            },
            {
              type: "line",
              speaker: "í™€ë¡œê·¸ë¨",
              bg: "Sc_04.mp4",
              text: "[í™€ë¡œê·¸ë¨ : ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.]",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "Calibration_Suite.png",
              text:
                "ë‹¤ìŒ ìˆœê°„, ê¸ˆì† íŒ¨ë„ì´ ë§¤ë„ëŸ½ê²Œ ì¢Œì¸¡ìœ¼ë¡œ ë¯¸ë„ëŸ¬ì§€ë“¯ ì—´ë ¸ë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "Calibration_Suite.png",
              text:
                "í‹ˆ ì‚¬ì´ë¡œ ì°¨ê°‘ê³  ì •ì œëœ í‘¸ë¥¸ ì¡°ìœ¨ì‹¤ì˜ ì¡°ëª…ì´ íë¥´ë©° ë‚´ë¶€ê°€ ì¡°ìš©íˆ ë“œëŸ¬ë‚œë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "V-Sync",
              bg: "201.png",
              text:
                "V-Sycn : ã€Œ ë°©ê¸ˆ, \"ë³µìŠ¤ ë™ê¸°í™” ì‹œë®¬ë ˆì´ì…˜\"ì— ê´€ì‹¬ì´ ìˆë‹¤ê³  í•˜ì…¨ìŠµë‹ˆê¹Œ? í•´ë‹¹ ì…ë ¥ ì‹ í˜¸ í™•ì¸ã€‚ê¸°ë¡ ì™„ë£Œã€‚ã€",
              autoNext: true
            },
            {
              type: "line",
              speaker: "V-Sync",
              bg: "200.png",
              text:
                "V-Sycn : ã€Œ ë‹¹ì‹ ì˜ ëª©ì â”€â”€ê·¸ë¶„ì„ ë” ì´í•´í•˜ê³  ì‹¶ë‹¤ëŠ” ì‘ë‹µ, ìˆ˜ì‹ í–ˆìŠµë‹ˆë‹¤ã€‚ã€",
              autoNext: true
            },
            {
              type: "line",
              speaker: "V-Sync",
              bg: "100.png",
              text: "V-Sycn : ã€Œ í”„ë¡œì„¸ìŠ¤ ì§„í–‰ì„ ìœ„í•´, ì‹ë³„ìš© ì´ë¦„ì„ ì…ë ¥í•˜ì‹­ì‹œì˜¤ã€‚ã€",
              autoNext: false
            },
            {
              type: "nameInput",
              namePrompt: "ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”."
            },
            {
              type: "line",
              speaker: "",
              bg: "201.png",
              text: "[ì´ë¦„] : [ì´ë¦„] ì…ë‹ˆë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "V-Sync",
              bg: "201.png",
              text:
                "V-Sycn : ã€Œ ì¢‹ìŠµë‹ˆë‹¤ã€‚ê·¸ë ‡ë‹¤ë©´, ì§€ê¸ˆ ë‹¹ì¥ ë³´ë‚´ë“œë¦¬ì£ ã€‚[ì´ë¦„]ã€‚ã€",
              autoNext: true
            },
            {
              type: "line",
              speaker: "V-Sync",
              bg: "201.png",
              text:
                "V-Sync : ã€Œ ì…ë ¥ ì‹ í˜¸ í™•ì¸ã€‚Â·Â·Â·ìŠ¹ì¸ã€‚í”„ë¡œí† ì½œ ì¦‰ì‹œ ì‹¤í–‰ã€‚ã€",
              autoNext: true
            },
            {
              type: "line",
              speaker: "V-Sync",
              bg: "201.png",
              text: "V-Sync : ã€Œ ì´ì œ ì „ì†¡í•©ë‹ˆë‹¤ã€‚[ì´ë¦„]ã€‚ã€",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "send.gif",
              text:
                "ë¸Œì´-ì‹±í¬ëŠ” ì ì í•˜ë˜ ì˜¤ë¥¸ì†ì˜ ì „ë¥˜ë¥¼ ì¡°ìš©íˆ ì¦í­ì‹œí‚¤ë”ë‹ˆ, ì†ë°”ë‹¥ì„ ë“¤ì–´ ì˜¬ë ¤ ë‹¹ì‹ ì˜ ë¨¸ë¦¬ ìœ„ì— ê°€ë³ê²Œ ì ‘ì´‰í–ˆë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "send.gif",
              text:
                "ìˆœê°„, ì†ëì—ì„œ í¼ì§€ëŠ” ì „ì íŒŒí˜•ì´ ë‹¹ì‹ ì˜ ê³ ìœ  ì‹ ê²½ ì£¼íŒŒìˆ˜ì™€ ê°•ì œë¡œ ë™ê¸°í™”ë˜ê¸° ì‹œì‘í•œë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "V-Sync",
              bg: "send.gif",
              text: "V-Sync : ã€Œ ì‹ í˜¸ ì£¼ì… í”„ë¡œí† ì½œ ê°œì‹œÂ·Â·Â· ã€",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "black.png",
              text:
                "ì‹œì•¼ê°€ í”ë“¤ë¦¬ê³ , ê¸ˆì†ì„± ìš¸ë¦¼ê³¼ í•¨ê»˜ ë‹¹ì‹ ì˜ ì¸ì‹ì´ ë‹¤ë¥¸ ê³µê°„ìœ¼ë¡œ 'ì „ì†¡'ëœë‹¤.",
              autoNext: true
            },
            {
              type: "line",
              speaker: "",
              bg: "black.png",
              text: "â–  NEXT",
              autoNext: false
            }
            // ëë‚˜ë©´ Scene1ìœ¼ë¡œ ìë™ ì´ë™
          ]
        },

        /* ì´í•˜: ë‚˜ë¨¸ì§€ SCENE 1~5 í•œêµ­ì–´/ì˜ì–´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì§ˆë¬¸ì—ì„œ ì£¼ì‹  ê·¸ëŒ€ë¡œ ìœ ì§€ */
        /* ... (ìƒëµ ì—†ì´ ì›ë³¸ ì½”ë“œì™€ ë™ì¼) ... */
      }
    },

    /* ===================== ENGLISH SCRIPT ===================== */
    en: {
      scenes: {
        /* ì „ì²´ ì˜ì–´ ìŠ¤í¬ë¦½íŠ¸ë„ ì§ˆë¬¸ ì½”ë“œì™€ ë™ì¼í•˜ê²Œ ìœ ì§€ */
        /* ... (ìƒëµ ì—†ì´ ì›ë³¸ ì½”ë“œì™€ ë™ì¼) ... */
      }
    }
  };

  /* ìœ„ì—ì„œ ì˜ì–´/í•œêµ­ì–´ ìŠ¤í¬ë¦½íŠ¸ì˜ ë‚˜ë¨¸ì§€ ë¶€ë¶„ì€
     ì§ˆë¬¸ì—ì„œ ì£¼ì‹  ë‚´ìš©ì„ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ë©´ ë©ë‹ˆë‹¤.
     (ê¸¸ì–´ì„œ ì¤‘ê°„ì„ ìƒëµ í‘œê¸°í–ˆì§€ë§Œ ì‹¤ì œë¡œëŠ” ì „ë¶€ ë„£ìœ¼ì‹œë©´ ë¼ìš”) */

  function normalizeScript() {
    ["ko", "en"].forEach(lang => {
      const langObj = SCRIPT[lang];
      if (!langObj || !langObj.scenes) return;

      const scenes = langObj.scenes;
      Object.keys(scenes).forEach(sceneId => {
        const scene = scenes[sceneId];
        const originalSteps = scene.steps || [];
        const newSteps = [];

        originalSteps.forEach(step => {
          if (step.type !== "line" || !step.text || step.text.indexOf("\n") === -1) {
            newSteps.push(step);
            return;
          }

          const lines = step.text.split("\n");
          const base = { ...step };

          lines.forEach((line, idx) => {
            const trimmed = line.trim();
            if (!trimmed) return;

            const isLast = idx === lines.length - 1;
            newSteps.push({
              ...base,
              text: trimmed,
              autoNext: !isLast ? true : base.autoNext
            });
          });
        });

        scene.steps = newSteps;
      });
    });
  }

  normalizeScript();

  /* =============================
     ê²Œì„ ìƒíƒœ & ì—”ë”© ê³„ì‚°
     ============================= */
  const gameState = {
    lang: settings.lang,
    sceneId: null,
    stepIndex: 0,
    playerName: "",
    choices: {}
  };

  function determineEndingFromChoices() {
    const c3 = gameState.choices.c3;
    const c4 = gameState.choices.c4;
    const c5 = gameState.choices.c5;
    const c6 = gameState.choices.c6;

    if (c3 === 2 && c4 === 3 && c5 === 2 && (c6 === 2 || c6 === 3)) {
      return "end1";
    }
    if (c3 === 2 && c4 === 2 && c5 === 3 && c6 === 1) {
      return "end2";
    }
    if ((c3 === 3 || c3 === 4) && (c4 === 4 || c4 === 2) && c5 === 4 && c6 === 4) {
      return "end3";
    }
    return "end4";
  }

  /* =============================
     ì¥ë©´ ìë™ ì—°ê²°ìš© ë§µ
     ============================= */
  const NEXT_SCENE_MAP = {
    scene0_after_choice1: "scene1_intro",

    scene1_path1: "scene2_intro",
    scene1_path2: "scene2_intro",
    scene1_path3: "scene2_intro",
    scene1_path4: "scene2_intro",

    scene2_path1: "scene3_intro",
    scene2_path2: "scene3_intro",
    scene2_path3: "scene3_intro",
    scene2_path4: "scene3_intro",

    scene3_path1: "scene4_intro",
    scene3_path2: "scene4_intro",
    scene3_path3: "scene4_intro",
    scene3_path4: "scene4_intro",

    scene4_path1: "scene5_intro",
    scene4_path2: "scene5_intro",
    scene4_path3: "scene5_intro",
    scene4_path4: "scene5_intro"
  };

  /* =============================
     DOM ìºì‹œ
     ============================= */
  const $loading        = document.getElementById("loading-screen");
  const $loadingLines   = document.querySelectorAll(".loading-line");
  const $progressBar    = document.querySelector(".loading-progress-bar");

  const $mainMenu       = document.getElementById("main-menu");
  const $gameScreen     = document.getElementById("game-screen");
  const $endingDbScreen = document.getElementById("ending-db-screen");
  const $creditsScreen  = document.getElementById("credits-screen");
  const $settingsScreen = document.getElementById("settings-screen");

  const $btnStart       = document.getElementById("btn-start");
  const $btnEndingDb    = document.getElementById("btn-ending-db");
  const $btnCredits     = document.getElementById("btn-credits");
  const $btnSettings    = document.getElementById("btn-settings");

  const $topLangLabel   = document.getElementById("top-lang-label");
  const $topSoundToggle = document.getElementById("top-sound-toggle");
  const $gameLangLabel  = document.getElementById("game-lang-label");
  const $gameSoundToggle= document.getElementById("game-sound-toggle");

  const $gameBg         = document.getElementById("game-bg");
  const $gameVideoBg    = document.getElementById("game-video-bg");
  const $chapterLabel   = document.getElementById("chapter-label");
  const $speakerName    = document.getElementById("speaker-name");
  const $dialogueText   = document.getElementById("dialogue-text");
  const $choices        = document.getElementById("choices");
  const $dialogueNext   = document.getElementById("dialogue-next");
  const $gameClickArea  = document.getElementById("game-click-area");

  const $nameInputWrapper = document.getElementById("name-input-wrapper");
  const $playerNameInput  = document.getElementById("player-name-input");
  const $playerNameConfirm= document.getElementById("player-name-confirm");

  const $endingDbGrid   = document.getElementById("ending-db-grid");

  const $contractOverlay = document.getElementById("contract-overlay");
  const $contractKo      = document.querySelector(".contract-ko");
  const $contractEn      = document.querySelector(".contract-en");

  /* =============================
     í™”ë©´ ì „í™˜ & í‘œì‹œ ìœ í‹¸
     ============================= */
  function showScreen(el) {
    [$mainMenu, $gameScreen, $endingDbScreen, $creditsScreen, $settingsScreen]
      .forEach(scr => scr.classList.add("hidden"));
    el.classList.remove("hidden");
  }

  function setLangVisual() {
    $topLangLabel.textContent  = settings.lang === "en" ? "EN" : "KO";
    $gameLangLabel.textContent = settings.lang === "en" ? "EN" : "KO";
  }

  function setSoundVisual() {
    $topSoundToggle.textContent  = globalMuted ? "OFF" : "ON";
    $gameSoundToggle.textContent = globalMuted ? "OFF" : "ON";
  }

  function replaceNamePlaceholders(text) {
    if (!text) return "";
    const name = gameState.playerName || (gameState.lang === "en" ? "???" : "???");
    return text
      .replace(/\[ì´ë¦„\]/g, name)
      .replace(/\[Name\]/g, name);
  }

  /* =============================
     íƒ€ì´í•‘ íš¨ê³¼
     ============================= */
  let typingTimer   = null;
  let autoNextTimer = null;
  let isTyping      = false;
  let currentFullText  = "";
  let currentCharIndex = 0;

  function startTyping(text) {
    clearTimeout(typingTimer);
    clearTimeout(autoNextTimer);
    currentFullText  = replaceNamePlaceholders(text || "");
    currentCharIndex = 0;
    isTyping         = true;
    $dialogueNext.classList.add("hidden");
    $dialogueText.textContent = "";
    stepTyping();
  }

  function stepTyping() {
    if (!isTyping) return;
    currentCharIndex++;
    $dialogueText.textContent = currentFullText.slice(0, currentCharIndex);
    if (currentCharIndex >= currentFullText.length) {
      isTyping = false;
      $dialogueNext.classList.remove("hidden");
    } else {
      typingTimer = setTimeout(stepTyping, 25);
    }
  }

  function finishTypingImmediately() {
    clearTimeout(typingTimer);
    isTyping = false;
    $dialogueText.textContent = currentFullText;
    $dialogueNext.classList.remove("hidden");
  }

  /* =============================
     ì¥ë©´/ìŠ¤í… í‘œì‹œ
     ============================= */
  function updateOverlayForStep(step) {
    $contractOverlay.classList.add("hidden");
    if (!step || !step.showContractPanel) return;

    if (settings.lang === "en") {
      $contractKo.classList.add("hidden");
      $contractEn.classList.remove("hidden");
    } else {
      $contractKo.classList.remove("hidden");
      $contractEn.classList.add("hidden");
    }

    $contractOverlay.classList.remove("hidden");
  }

  function setBackground(bg) {
    if (!bg) return;

    if (bg.toLowerCase().endsWith(".mp4")) {
      $gameBg.style.backgroundImage = "none";
      $gameVideoBg.classList.remove("hidden");
      $gameVideoBg.src = bg;
      $gameVideoBg.currentTime = 0;
      $gameVideoBg.play().catch(() => {});
    } else {
      $gameVideoBg.pause();
      $gameVideoBg.classList.add("hidden");
      $gameBg.style.backgroundImage = `url("${bg}")`;
    }
  }

  function getCurrentSceneObj() {
    const langObj = SCRIPT[gameState.lang];
    if (!langObj) return null;
    return langObj.scenes[gameState.sceneId];
  }

  function refreshChapterAndBg(sceneObj) {
    if (!sceneObj) return;
    $chapterLabel.textContent = sceneObj.chapter || "";
    if (sceneObj.bg) {
      setBackground(sceneObj.bg);
    }
  }

  function goToScene(sceneId, stepIndex = 0) {
    gameState.sceneId  = sceneId;
    gameState.stepIndex= stepIndex;

    const sceneObj = getCurrentSceneObj();
    if (!sceneObj) return;
    refreshChapterAndBg(sceneObj);

    if (sceneId.startsWith("scene0")) playBgm("scene0");
    else if (sceneId.startsWith("scene1")) playBgm("scene1");
    else if (sceneId.startsWith("scene2")) playBgm("scene2");
    else if (sceneId.startsWith("scene3")) playBgm("scene3");
    else if (sceneId.startsWith("scene4")) playBgm("scene4");
    else if (sceneId.startsWith("scene5")) playBgm("scene5");

    showCurrentStep();
  }

  function showCurrentStep() {
    clearTimeout(autoNextTimer);
    const sceneObj = getCurrentSceneObj();
    if (!sceneObj) return;
    const steps = sceneObj.steps || [];
    if (gameState.stepIndex >= steps.length) return;
    const step = steps[gameState.stepIndex];

    updateOverlayForStep(step);

    $choices.innerHTML = "";
    $nameInputWrapper.classList.add("hidden");
    $speakerName.textContent = "";
    $dialogueNext.classList.add("hidden");

    if (step.bg) {
      setBackground(step.bg);
    }

    if (step.type === "line") {
      $speakerName.textContent = step.speaker || "";
      startTyping(step.text || "");
      if (step.autoNext) {
        autoNextTimer = setTimeout(() => {
          advanceStep();
        }, 10000);
      }
    } else if (step.type === "choice") {
      (step.options || []).forEach((opt, idx) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = opt.text;
        btn.addEventListener("click", () => {
          if (step.storeChoiceKey) {
            gameState.choices[step.storeChoiceKey] = idx + 1;
          }
          if (opt.nextScene) {
            goToScene(opt.nextScene, 0);
          }
        });
        $choices.appendChild(btn);
      });
      $dialogueText.textContent = "";
    } else if (step.type === "nameInput") {
      $dialogueText.textContent = step.namePrompt || "";
      $nameInputWrapper.classList.remove("hidden");
    } else if (step.type === "ending") {
      unlockEnding(step.endingId);
      startTyping(step.text || "");
    }
  }

  function advanceStep() {
    const sceneObj = getCurrentSceneObj();
    if (!sceneObj) return;
    const steps = sceneObj.steps || [];
    const step = steps[gameState.stepIndex];

    if (step && step.type === "ending") {
      showScreen($mainMenu);
      playBgm("main");
      renderEndingDatabase();
      return;
    }

    gameState.stepIndex++;
    if (gameState.stepIndex >= steps.length) {
      const sid = gameState.sceneId;

      if (sid in NEXT_SCENE_MAP) {
        goToScene(NEXT_SCENE_MAP[sid], 0);
        return;
      }

      if (sid === "scene5_intro") {
        const eid = determineEndingFromChoices();
        const map = {
          end1: "scene5_end1",
          end2: "scene5_end2",
          end3: "scene5_end3",
          end4: "scene5_end4"
        };
        const next = map[eid] || "scene5_end4";
        goToScene(next, 0);
        return;
      }
      return;
    }
    showCurrentStep();
  }

  /* =============================
     SETTINGS íŒ¨ë„ / ENDING DB
     ============================= */
  function refreshSettingsPanel() {
    document.querySelectorAll(".pill-toggle[data-lang]").forEach(btn => {
      btn.classList.toggle("active", btn.getAttribute("data-lang") === settings.lang);
    });
    document.querySelectorAll(".pill-toggle[data-autosound]").forEach(btn => {
      const on = btn.getAttribute("data-autosound") === "on";
      btn.classList.toggle("active", settings.autoSound === on);
    });
  }

  function renderEndingDatabase() {
    $endingDbGrid.innerHTML = "";
    ENDINGS.forEach(end => {
      const unlocked = !!unlockedEndings[end.id];
      const card = document.createElement("div");
      card.className = "ending-card";

      const thumb = document.createElement("div");
      thumb.className = "ending-thumb" + (unlocked ? "" : " locked");
      thumb.style.backgroundImage = `url("${end.img}")`;
      const tag = document.createElement("div");
      tag.className = "ending-tag";
      tag.textContent = end.code;
      thumb.appendChild(tag);

      const title = document.createElement("div");
      title.className = "ending-title";
      title.textContent = unlocked ? end.title[settings.lang] : "???";

      const desc = document.createElement("div");
      desc.className = "ending-desc";
      desc.textContent = unlocked
        ? end.desc[settings.lang]
        : (settings.lang === "en"
            ? "Ending not yet unlocked."
            : "ì•„ì§ í•´ê¸ˆë˜ì§€ ì•Šì€ ì—”ë”©ì…ë‹ˆë‹¤.");

      const lockLabel = document.createElement("div");
      lockLabel.className = "ending-locked-label";
      if (!unlocked) lockLabel.textContent = "[???]";

      card.appendChild(thumb);
      card.appendChild(title);
      card.appendChild(desc);
      if (!unlocked) card.appendChild(lockLabel);

      $endingDbGrid.appendChild(card);
    });
  }

  /* =============================
     ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
     ============================= */

  $btnStart.addEventListener("click", () => {
    gameState.lang = settings.lang;
    gameState.playerName = "";
    gameState.choices = {};
    setLangVisual();
    showScreen($gameScreen);
    goToScene("scene0_intro", 0);
  });

  $btnEndingDb.addEventListener("click", () => {
    renderEndingDatabase();
    showScreen($endingDbScreen);
  });

  $btnCredits.addEventListener("click", () => {
    showScreen($creditsScreen);
  });

  $btnSettings.addEventListener("click", () => {
    showScreen($settingsScreen);
    refreshSettingsPanel();
  });

  document.querySelectorAll(".panel-close").forEach(el => {
    el.addEventListener("click", () => {
      const targetId = el.getAttribute("data-close");
      if (targetId) {
        const target = document.getElementById(targetId);
        if (target) target.classList.add("hidden");
      }
      showScreen($mainMenu);
    });
  });

  function toggleGlobalSound() {
    globalMuted = !globalMuted;
    setSoundVisual();
    Object.values(audioMap).forEach(a => {
      a.muted = globalMuted;
    });
    if (!globalMuted && currentBgmKey && settings.autoSound) {
      const a = audioMap[currentBgmKey];
      if (a && a.paused) a.play().catch(() => {});
    }
  }

  $topSoundToggle.addEventListener("click", toggleGlobalSound);
  $gameSoundToggle.addEventListener("click", toggleGlobalSound);

  document.querySelectorAll(".pill-toggle[data-lang]").forEach(btn => {
    btn.addEventListener("click", () => {
      settings.lang = btn.getAttribute("data-lang") === "en" ? "en" : "ko";
      saveSettings();
      setLangVisual();
      refreshSettingsPanel();
    });
  });

  document.querySelectorAll(".pill-toggle[data-autosound]").forEach(btn => {
    btn.addEventListener("click", () => {
      const on = btn.getAttribute("data-autosound") === "on";
      settings.autoSound = on;
      saveSettings();
      refreshSettingsPanel();
    });
  });

  $gameClickArea.addEventListener("click", (e) => {
    if (e.target.closest(".choice-btn") || e.target.closest("#name-input-wrapper")) {
      return;
    }
    const sceneObj = getCurrentSceneObj();
    if (!sceneObj) return;
    const step = sceneObj.steps[gameState.stepIndex];
    if (!step || step.type !== "line") return;

    if (isTyping) {
      finishTypingImmediately();
    } else {
      advanceStep();
    }
  });

  $playerNameConfirm.addEventListener("click", () => {
    const val = $playerNameInput.value.trim();
    if (!val) return;
    gameState.playerName = val;
    $nameInputWrapper.classList.add("hidden");
    advanceStep();
  });

  $playerNameInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      $playerNameConfirm.click();
    }
  });

  /* =============================
     ë¡œë”© ì‹œí€€ìŠ¤ (ë¶€ë“œëŸ¬ìš´ ë²„ì „)
     ============================= */
  function startLoadingSequence() {
    const lines = $loadingLines;
    let step = 0;

    function showStep() {
      if (step < lines.length) {
        lines[step].classList.add("active");
        step++;
        setTimeout(showStep, 900);
      } else {
        setTimeout(() => {
          if ($loading) {
            $loading.style.opacity = "0";
            $loading.style.pointerEvents = "none";
            setTimeout(() => {
              $loading.classList.add("hidden");
              showScreen($mainMenu);
              playBgm("main");
            }, 400);
          } else {
            showScreen($mainMenu);
            playBgm("main");
          }
        }, 900);
      }
    }

    if (lines.length && $loading) {
      $loading.style.opacity = "1";
      $loading.style.pointerEvents = "auto";
      showStep();
    } else {
      showScreen($mainMenu);
      playBgm("main");
    }
  }

  /* =============================
     ì´ˆê¸°í™”
     ============================= */
  initAudio();
  setLangVisual();
  setSoundVisual();
  startLoadingSequence();
</script>
</body>
</html>
